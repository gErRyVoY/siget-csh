---
import '@/styles/global.css'; 
import GoogleIcon from "@/components/icons/GoogleIcon.astro";
import { Image } from 'astro:assets';
import { SignIn } from 'auth-astro/components';

const title = 'Login | CSH';

// --- Gestión de Errores de Login ---
const { searchParams } = Astro.url;
const error = searchParams.get('error');

let errorMessage: { title: string; message: string; } | null = null;

if (error) {
    switch (error) {
        case 'DominioNoPermitido':
            errorMessage = {
                title: 'Acceso Denegado',
                message: 'Solo se permite el acceso con un correo institucional verificado.'
            };
            break;
        case 'OUNoAsignada':
            errorMessage = {
                title: 'Acceso Denegado',
                message: 'Su correo no puede ser usado para usar éste servicio.'
            };
            break;
        case 'NoToken':
        case 'NoProfile':
        case 'ErrorInterno':
            errorMessage = {
                title: 'Error de Autenticación',
                message: 'No se pudo verificar tu identidad. Por favor, intenta de nuevo.'
            };
            break;
    }
}
---

<!doctype html>
<html lang="es-MX">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/logo-h-wine.png" />
    <meta name="generator" content={Astro.generator} />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <title>{title}</title>
</head>
<body>
    <main class="container h-screen w-screen bg-background flex justify-center items-center font-montse">
        <div class="flex flex-col items-center justify-center gap-8 rounded-xl border-2 border-primary/90 p-6 shadow-lg max-w-md w-full">
            <Image src={'/logotipo-desde-vino.webp'} alt={'Universidad Humanitas'} width={421} height={57} />
            
            <div class="flex flex-col justify-center gap-4 w-full">
                <h1 class="text-secondary text-lg text-center">
                    Inicia sesión con tu correo institucional<br>
                    <span class="italic font-bold">@humanitas.edu.mx</span>
                </h1>

                <!-- Mensaje de Error Dinámico -->
                {errorMessage && (
                    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md" role="alert">
                        <p class="font-bold">{errorMessage.title}</p>
                        <p>{errorMessage.message}</p>
                    </div>
                )}

                <!-- Enlace de Login (reemplaza el formulario) -->
                <!-- <a href="/api/auth/signin/google" class="w-full inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-xl font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary/90 text-primary-foreground shadow-sm hover:bg-secondary/90 transition-colors duration-500 h-15 px-4 py-2">
                    <GoogleIcon class="h-10 w-10" />Continuar con Google
                    </a> -->
                <SignIn provider="google" class="w-full inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-xl font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary/90 text-primary-foreground shadow-sm hover:bg-secondary/90 transition-colors duration-500 h-15 px-4 py-2">
                    <GoogleIcon class="h-10 w-10" />Continuar con Google
                </SignIn>
            </div>

            <Image src={'/abeja-2025-se-tu-mejor-version.png'} alt={'Sé tu mejor versión.'} width={421} height={57} />
        </div>
    </main>
</body>
</html>